<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tr√¨nh T·∫°o M√£ QR T√≠ch H·ª£p</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f3f4f6; margin:0; padding:0;
           display:flex; justify-content:center; align-items:flex-start; min-height:100vh; }
    .container { background:#fff; margin-top:40px; padding:30px; border-radius:12px;
                 box-shadow:0 4px 12px rgba(0,0,0,0.1); max-width:500px; width:90%; }
    h2 { margin-top:0; text-align:center; }
    input[type="text"] { width:100%; padding:10px; margin:10px 0; border:1px solid #ccc; border-radius:6px;}
    button { width:100%; padding:12px; margin:8px 0; border:none; border-radius:6px;
             font-size:16px; cursor:pointer; color:#fff; }
    button.primary { background-color:#2563eb; }
    button.primary:hover { background-color:#1e40af; }
    button.success { background-color:#10b981; }
    button.success:hover { background-color:#059669; }
    #qrcode-container { display:none; text-align:center; margin-top:20px; }
    #qrcode-img { max-width:100%; border:1px solid #ddd; }
    #apiLink { display:block; margin:12px 0; word-break:break-all; color:#2563eb; }
    #copyMsg { color:#16a34a; display:none; }
    #instructions { margin-top:30px; background:#f9fafb; padding:20px; border-radius:8px; font-size:14px; }
    pre { background:#e5e7eb; padding:8px; overflow-x:auto; border-radius:4px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>üì∑ T·∫°o QR Code (Server-side)</h2>
    <input type="text" id="content" placeholder="Nh·∫≠p n·ªôi dung (URL ho·∫∑c vƒÉn b·∫£n)" />
    <button class="primary" id="generateBtn">T·∫°o QR Code</button>
    <div id="qrcode-container">
      <img id="qrcode-img" src="" alt="QR Code" />
      <a id="apiLink" href="#" target="_blank" rel="noopener noreferrer"></a>
      <button class="success" id="copyBtn">Copy link API</button>
      <button class="success" id="downloadBtn">T·∫£i ·∫£nh QR v·ªÅ</button>
      <p id="copyMsg">‚úÖ ƒê√£ copy v√†o b·ªô nh·ªõ!</p>
    </div>
    <div id="instructions">
      <h3>üîß H∆∞·ªõng d·∫´n</h3>
      <ol>
        <li>Nh·∫≠p n·ªôi dung v√†o √¥ tr√™n, v√≠ d·ª•: <code>https://example.com</code> ho·∫∑c vƒÉn b·∫£n.</li>
        <li>Nh·∫•n <strong>T·∫°o QR Code</strong>.</li>
        <li>H·ªá th·ªëng s·∫Ω g·ªçi Web App v√† hi·ªÉn th·ªã ·∫£nh QR.</li>
        <li>Sao ch√©p link API ho·∫∑c b·∫•m <strong>T·∫£i ·∫£nh QR v·ªÅ</strong> ƒë·ªÉ s·ª≠ d·ª•ng.</li>
      </ol>
      <p><strong>V√≠ d·ª• link API:</strong></p>
      <pre id="apiExample"></pre>
    </div>
  </div>

  <script>
    const webAppBase = '<?= webAppUrl ?>'; // t·ª´ GAS template

    const contentInput = document.getElementById('content');
    const generateBtn = document.getElementById('generateBtn');
    const qrcodeContainer = document.getElementById('qrcode-container');
    const qrcodeImg = document.getElementById('qrcode-img');
    const apiLink = document.getElementById('apiLink');
    const copyBtn = document.getElementById('copyBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const copyMsg = document.getElementById('copyMsg');
    const apiExample = document.getElementById('apiExample');

    function buildApiUrl(text) {
      return `${webAppBase}?content=${encodeURIComponent(text)}&raw=1`;
    }

    generateBtn.addEventListener('click', () => {
      const text = contentInput.value.trim();
      if (!text) return alert('Vui l√≤ng nh·∫≠p n·ªôi dung!');
      const url = buildApiUrl(text);
      qrcodeImg.src = url;
      apiLink.href = url;
      apiLink.textContent = url;
      apiExample.textContent = url;
      qrcodeContainer.style.display = 'block';
      copyMsg.style.display = 'none';
    });

    copyBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(apiLink.href)
        .then(() => {
          copyMsg.style.display = 'block';
          setTimeout(() => copyMsg.style.display = 'none', 2000);
        })
        .catch(() => alert('Kh√¥ng th·ªÉ copy, xin vui l√≤ng copy th·ªß c√¥ng.'));
    });

    downloadBtn.addEventListener('click', () => {
      if (!qrcodeImg.src) return alert('Ch∆∞a c√≥ ·∫£nh ƒë·ªÉ t·∫£i!');
      const a = document.createElement('a');
      a.href = qrcodeImg.src;
      a.download = 'qrcode.png';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });
  </script>
</body>
</html>


